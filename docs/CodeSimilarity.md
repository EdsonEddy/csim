# csim

This project analyzes structural similarity between Python source code using
ANTLR4-generated ASTs and Zhang–Shasha Tree Edit Distance (ZSS).

## AST Normalization and ZSS Tree Construction

This project compares Python source code by measuring **structural similarity**
between normalized Abstract Syntax Trees (ASTs).
The ASTs are generated using **ANTLR4** and compared using
**Zhang–Shasha Tree Edit Distance (ZSS)**.

To ensure **experimental reproducibility, efficiency, and traceability**,
the following design decisions are applied.

### Rule and Token Exclusion Strategy

Instead of relying on rule names or regular expressions, this project
exclusively uses:

- `ruleIndex` for parser rules
- `token.type` for lexer tokens

Both identifiers are **numeric constants generated by ANTLR**, which guarantees:

- O(1) comparisons
- Independence from rule names
- Robustness across grammar or version changes

#### Excluded Parser Rules

Excluded rules are defined as:

```python
EXCLUDED_RULE_INDICES: set[int]
```

Rules are excluded when they do **not contribute meaningful semantic or
structural information**. These typically fall into the following categories:

- **Syntactic wrappers** (e.g. `Statement`, `Simple_stmt`, `Statements`)
- **Expression precedence layers** (e.g. `Disjunction`, `Sum`, `Term`, `Factor`)
- **Technical or auxiliary rules**
  (e.g. `Star_atom`, `Target_with_star_atom`, `Name_except_underscore`)

#### Excluded Tokens

Similarly, purely syntactic tokens are excluded using:

```python
EXCLUDED_TOKEN_TYPES: set[int]
```

Typical examples include parentheses, commas, colons,
`INDENT` / `DEDENT`, and `EOF`.

### ZSS Tree Construction

The normalized tree is constructed using an **ANTLR Visitor**.

Each node in the resulting ZSS tree represents one of:

- A **parser rule** (`ruleIndex`)
- A **relevant lexer token** (`token.type`)
- An internal **GROUP node** used to collapse excluded rules

All nodes are labeled using **integer identifiers only**.

#### Rule Collapsing (Tree Pruning)

If a visited rule belongs to `EXCLUDED_RULE_INDICES`:

- A single valid child is propagated upward
- Multiple children are grouped under a `GROUP` node
- Nodes with no valid children are discarded

This reduces artificial AST depth while preserving structure.

### Tree Edit Distance Configuration

Similarity is computed using **Zhang–Shasha Tree Edit Distance (ZSS)**.

Recommended base costs:

| Operation | Cost |
|---------|------|
| Insert  | 1 |
| Delete | 1 |
| Update (same label) | 0 |
| Update (different label) | 1 |

Optional extensions may assign different costs for RULE, TOKEN, or GROUP nodes
to enable comparisons at different abstraction levels.

### Experimental Traceability

These design choices provide:

- Deterministic and reproducible comparisons
- Clear justification of AST transformations
- Fine-grained control over abstraction levels
